{"version":3,"file":"build.js","sourceRoot":"","sources":["build.ts"],"names":[],"mappings":"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","sourcesContent":["import chalk from \"chalk\";\nimport {spawnSync} from \"child_process\";\nimport yargs from \"yargs\";\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nconst {version} = require(\"../package.json\");\n\nfunction spawn(command: string, args: string[], errorMessage: string) {\n    const isWindows = process.platform === \"win32\";\n    const result = spawnSync(isWindows ? command + \".cmd\" : command, args, {stdio: \"inherit\"});\n    if (result.error) {\n        console.error(result.error);\n        process.exit(1);\n    }\n    if (result.status !== 0) {\n        console.error(chalk`{red.bold ${errorMessage}}`);\n        console.error(`non-zero exit code returned, code=${result.status}, command=${command} ${args.join(\" \")}`);\n        process.exit(1);\n    }\n}\n\nfunction checkCodeStyle() {\n    console.info(chalk`{green.bold [task]} {white.bold check code style}`);\n    return spawn(\"prettier\", [\"--config\", \"config/prettier.json\", \"--list-different\", \"{src,test}/**/*.{ts,tsx}\"], \"check code style failed, please format above files\");\n}\n\nfunction lint() {\n    console.info(chalk`{green.bold [task]} {white.bold lint}`);\n    return spawn(\"eslint\", [\"{src,test}/**/*.{ts,tsx}\"], \"lint failed, please fix\");\n}\n\nfunction cleanup() {\n    console.info(chalk`{green.bold [task]} {white.bold cleanup}`);\n    return spawn(\"rm\", [\"-rf\", \"./dist\"], \"cannot remove dist folder\");\n}\n\nfunction compile() {\n    console.info(chalk`{green.bold [task]} {white.bold compile}`);\n    return spawn(\"tsc\", [\"-p\", \"config/tsconfig.json\"], \"compile failed, please fix\");\n}\n\nfunction commit() {\n    console.info(chalk`{green.bold [task]} {white.bold commit to git}`);\n    spawn(\"git\", [\"add\", \".\"], \"cannot add changes to git tree\");\n    return spawn(\"git\", [\"commit\", \"-m\", `[SYSTEM]: ${version}: build package`], \"cannot commit changes\");\n}\n\nfunction push() {\n    console.info(chalk`{green.bold [task]} {white.bold push to github}`);\n    spawn(\"git\", [\"pull\", \"--rebase\", \"--autostash\"], \"cannot pull changes from upstream\");\n    return spawn(\"git\", [\"push\", \"-u\", \"origin\", \"master\"], \"cannot push to github\");\n}\n\nfunction build() {\n    const isFastMode = yargs.argv.mode === \"fast\";\n\n    if (!isFastMode) {\n        checkCodeStyle();\n        lint();\n    }\n\n    cleanup();\n    compile();\n    commit();\n    push();\n}\n\nbuild();\n"]}